<include file="public@header" />
</head>
<body>
	<div class="wrap">
		<ul class="nav nav-tabs"> 
			<include file="public@nav" />
		</ul>
		<form class="form-horizontal js-ajax-form{$zzajax} margin-top-20" role="form" method="post" action="{:url('add_do')}">
			 
			 		 
	   		 <div class="form-group fleft">
				<label  class="col-sm-2 control-label">订单来源</label>
				<div class="col-md-6 col-sm-10">
				<select  class="form-control "  name="company"  required>
					<option value="0">订单来源</option>
					<foreach name="companys" item="vo">
					<option value="{$key}" <if condition="$key eq $info.company" >selected</if>>{$vo.name}</option>
					</foreach>
					</select>  
				</div>
			</div>
 
			 <div class="form-group fleft-all">
				<label  class="col-sm-2 control-label">客户筛选</label>
				<div class="col-md-6 col-sm-10">
			 		<select  class="form-control  short-auto" id="company"   >
						<option value="0">客户来源</option>
					<foreach name="companys" item="vo">
						<option value="{$key}" <if condition="$key eq $custom.company" >selected</if>>{$vo.name}</option>
					</foreach>
					</select>  
					 
					<select  class="form-control short-auto" id="custom_cate"  > 
						<option value="0">客户分类</option>
					<foreach name="custom_cates" item="vo">
						<option value="{$key}" <if condition="$key eq $custom.cid"></if>>{$vo}</option>
					</foreach>
					</select>
					<select  class="form-control short-auto" id="province"  > 
						<option value="0">客户所在省</option> 
					</select>
					<select  class="form-control short-auto" id="city"  > 
						<option value="0">客户所在市</option> 
					</select> 
					<p class="notice">客户所在省为必选项</p>
				</div>
			</div>
	 
			 <div class="form-group fleft-all">
				<label  class="col-sm-2 control-label">客户</label>
				<div class="col-md-6 col-sm-10"> 
					 
					<select  class="form-control " name="uid" id="custom"   >
						<option value="{$custom.id}" >{$custom.name|default="请选择客户"}</option>
					</select>
					<a href="{:url('custom/AdminCustom/edit',['id'=>$custom.id])}" target="{$zztarget['other']}" id="custom_link">客户详情</a>
				</div>
			</div>
			 <div class="form-group fleft-all accept">
				<label  class="col-sm-2 control-label">收货人</label>
				<div class="col-md-6 col-sm-10">
				<empty name="info.id">
					<select  class="form-control " name="accept" id="accept" required >  
					</select>
					 
				<else/>
					<input type="text" class="form-control " value="{$info.accept_name},{$info.telphone},{$info.mobile},{$info.addressinfo}{$info.address},{$info.postcode}"/>
				</empty>
				</div>
			</div>
			 <div class="form-group fleft-all accept">
				<label  class="col-sm-2 control-label">该客户发货注意事项</label>
				<div class="col-md-6 col-sm-10">
				 
					<input type="text" class="form-control " value="{$custom.announcement}" id="announcement"/>
				 
				</div>
			</div>
	  		<div class="form-group fleft-all"  >
				<label  class="col-sm-2 control-label">用户留言</label>
				<div class="col-md-6 col-sm-10" > 
				  <input type="text" class="form-control" name="udsc" value="{$info.udsc}" />
				<present name="change.udsc">
					<input type="text" class="form-control red"  value="{$change.udsc}" />
				</present>
				</div>
			</div>
			<div style="clear:both"></div>
			 
		  
			
			<div class="form-group fleft-all">
				<label  class="col-sm-2 control-label">添加产品</label>
				<div class="col-md-6 col-sm-10">
				   <include file="public@cate_goods" />  
					 <button type="button" id="goods_link">确定</button>
				 
				</div>
			</div>
			
			<div style="clear:both"></div>
			
			<div style="clear:both"></div>
			
			<div class="form-group fleft">
				<label  class="col-sm-2 control-label">物流方式</label>
				<div class="col-md-6 col-sm-10">
				   <select  class="form-control" name="freight" id="freight" required>
				    	<option value="0">请选择</option>
					<foreach name="freights" item="vo">
						<option class="store{$vo.store}" value="{$key}" <if condition="$key eq $info.freight" >selected</if>>{$vo.name}</option>
					</foreach>
					</select>
				<present name="change.freight">
					<select  class="form-control red"  >
				   		<option value="0">请选择</option>
					<foreach name="freights" item="vo">
						<option value="{$key}" <if condition="$key eq $change.freight" >selected</if>>{$vo.name}</option>
					</foreach>
					</select>
				</present>  
				 </div>
			</div>
			<div class="form-group fleft">
				<label  class="col-sm-2 control-label">客户付款方式</label>
				<div class="col-md-6 col-sm-10">
				   <select  class="form-control" name="paytype" id="paytype" required>
				   		<option value="0">请选择</option>
					<foreach name="paytypes" item="vo">
						<option value="{$key}" <if condition="$key eq $info.paytype" >selected</if>>{$vo.name}</option>
					</foreach>
					</select>
				<present name="change.paytype">
					<select  class="form-control red"  > 
						<option value="{$key}" >{$paytypes[$change['paytype']]|default=$change['paytype']}</option> 
					</select>
				</present>
				</div>
			</div>
			 
			<div class="form-group fleft-all">
				<label  class="col-sm-2 control-label">用户付款</label>
				<div class="col-md-6 col-sm-10">
				用户付款账号：
					<select  class="form-control" id="account">
				    	<option value="0">请选择</option> 
					</select> 
				付款银行：
					<select  class="form-control" name="account-bank1" id="account-bank1">
				    	<option value="0">请选择</option>
					<foreach name="banks" item="vo">
						<option value="{$key}"  >{$vo}</option>
					</foreach>
					</select>
				   付款 账户名：<input type="text"  class="form-control" name="account-name1" id="account-name1"/>
				    <p class="notice">付款账户名为空则不保存付款信息</p>  
				   付款账号：<input type="text"  class="form-control" name="account-num1" id="account-num1"/>
				   付款开户行：<input type="text"  class="form-control" name="account-location1" id="account-location1"/>
				   收款银行：
					<select  class="form-control" name="account-bank2" id="account-bank2">
				    	<option value="0">请选择</option>
					<foreach name="banks" item="vo">
						<option value="{$key}"  >{$vo}</option>
					</foreach>
					</select>
				   收款 账户名：<input type="text"  class="form-control" name="account-name2" id="account-name2"/>
				   收款账号：<input type="text"  class="form-control" name="account-num2" id="account-num2"/>
				   收款开户行：<input type="text"  class="form-control" name="account-location2" id="account-location2"/>
				
				</div>
			</div>
			<div class="form-group fleft">
				<label  class="col-sm-2 control-label">开票类型</label>
				<div class="col-md-6 col-sm-10">
				   <select  class="form-control" name="invoice_type" id="invoice_type">
					<foreach name="invoice_types" item="vo">
					<option value="{$key}" <if condition="$key eq $info.invoice_type" >selected</if>>{$vo}</option>
					</foreach>
					</select>
				 <present name="change.invoice_type">
					<select  class="form-control red"  >
				   	 
					<foreach name="invoice_types" item="vo">
						<option value="{$key}" <if condition="$key eq $change.invoice_type" >selected</if>>{$vo}</option>
					</foreach>
					</select>
				</present>   
				 </div>
			</div>
			 <div class="form-group fleft-all" id="invoice_info">
				<label class="col-sm-2 control-label">发票信息</label>
				<div class="col-md-6 col-sm-10">
					<input type="hidden"  name="invoice_id" value="{$invoice.id}"/>
					发票抬头:<input type="text" class="form-control" name="invoice-title" value="{$invoice.title}"/>
					客户税号:<input type="text" class="form-control short-auto" name="invoice-ucode" value="{$invoice.ucode}"/>
					税点:<input type="text" class="form-control short" name="invoice-point" value="{$invoice.point}"/>%
					开票金额:<input type="text" class="form-control short" name="invoice-invoice_money" value="{$invoice.invoice_money}"/>
					 <br/>
					开票说明:<input type="text" class="form-control" name="invoice-dsc" value="{$invoice.dsc}"/>
					   <p class="notice">发票类型为不开票或发票抬头为空则不保存发票信息</p>  
				</div>
			</div>
			<div style="clear:both"></div>
			
		 
			 
			<div style="clear:both"></div>
			 <div class="form-group fleft" style="width:100%">
				<label class="col-sm-2 control-label">管理员备注</label>
				<div class="col-md-6 col-sm-10">
					 <input type="text" class="form-control" name="dsc" value="{$info.adsc}" /> 
				</div>
			</div>
			 
		<div style="clear:both"></div>
		 
		<div style="clear:both"></div>
		<notempty name="info1.aid">
			<div class="form-group ">
				<label for="" class="col-sm-2 control-label">修改人</label>
				<div class="col-md-6 col-sm-10">
					<input type="text" class="form-control"  value="{$info1.aname|default=$info1['aid']}" readonly/>
				</div>
			</div>
		</notempty>
		<notempty name="info1.rid">
			<div class="form-group ">
				<label for="" class="col-sm-2 control-label">修改审核人</label>
				<div class="col-md-6 col-sm-10">
					<input type="text" class="form-control"  value="{$info1.rname|default=$info1['rid']}" readonly/>
				</div>
			</div>
		</notempty>
		<div style="clear:both"></div>
		<present name="info.id">
			<div class="form-group "  >
				<label class="col-sm-2 control-label">修改备注</label>
				<div class="col-md-6 col-sm-10">
					<input type="text" class="form-control" name="adsc" value="{$info1.adsc|default=''}"  />
					<p class="notice">修改人修改信息时可以先写此备注提醒审核人</p>
				</div>
			</div>
		</present>
		<present name="change">
			<div class="form-group "  >
				<label class="col-sm-2 control-label">审核意见</label>
				<div class="col-md-6 col-sm-10">
					<input type="text" class="form-control" name="rdsc" value="{$info1.rdsc|default=''}"  />
					<p class="notice">审核人审核信息时可以填写</p>
				</div>
			</div>
		</present>
		 <div style="clear:both"></div>
 
			 
			<div class="form-group">
				<div class="col-sm-offset-2 col-sm-10">
					<button type="submit" class="btn btn-primary js-ajax-submit">{:lang('SAVE')}</button>
					 <p>添加订单后需管理员审核后才能生效</p>
				</div>
			</div>
		</form>
	</div>
	<script src="__STATIC__/js/admin.js"></script>
	 
</body>
</html>
<script>
//城市选择js初始化 
get_citys($('#province'),1,0);
var company=0;
var cid=0;
var province=0;
var city=0;
 
var url_custom_get="{:url('custom/Customajax/get_customs')}";
var url_custom_info="{:url('custom/Customajax/get_custom_info')}";
var url_custom="{:url('custom/AdminCustom/edit','',false,false)}"+'/id/';
var arr;
var receiver=1;
var account=1;
$('#invoice_type').val(2);
$('#province').change(function(){
	province=$('#province').val();
	get_citys($('#city'),province,0);
	
	company=$('#company').val();
	cid=$('#custom_cate').val(); 
	city=0;
	custom_get(company,cid,province,city);
});
$('#company,#custom_cate,#city').change(function(){
	company=$('#company').val();
	cid=$('#custom_cate').val();
	province=$('#province').val();
	city=$('#city').val();
	custom_get(company,cid,province,city); 
});
function custom_get(company,cid,province,city){
	if(province==0){
		return false;
	}
	$.post(url_custom_get,{'company':company,'cid':cid,'type':1,'province':province,'city':city},function(data){
		if(data.code!=1){
			return false;
		} 
		var list=data.data;
		var options='<option value="0">请选择客户</option>';
		for(var i in list){
			options+='<option value="'+i+'" >'+list[i]+'</option>';
		}
		$('#custom').html(options); 
		$('.accept input').val('');
	},'json');
}
$('#custom').change(function(){
	 var custom=$(this).val();
	 
	 if(custom==0){ 
		 $('.accept select').val(0);
		 $('#custom_link').attr('href',url_custom+custom);
		 return false;
	 } 
	  $('#custom_link').attr('href',url_custom+custom);
	 $.post(url_custom_info,{'uid':custom,'type':1},function(data){
			if(data.code!=1){
				return false;
			}  
			var info=data.data;
			var list=info.tels;
			var selected=''; 
			 console.log(info);
			var options='<option value="0">选择收货人</option>'; 
			//options+='<option value="'+list[i]['province']+','+list[i]['city']+','+list[i]['area']+'" '+selected+' > 
			for(var i in list){
				if(custom==i){
					selected='selected';  
				}else{
					selected=''; 
				} 
				options+='<option value="'+i+'" '+selected+' >'+
				list[i]['name']+','+list[i]['mobile']+','+list[i]['phone']+','+
				list[i]['province_name']+list[i]['city_name']+list[i]['area_name']+list[i]['street']+','+list[i]['postcode']+'</option>'; 
			}
			 $('#accept').html(options); 
			 
			 $('#invoice_type').val(info.invoice_type); 
			 $('#tax_point').val(info.tax_point);
			 $('#announcement').val(info.announcement);
			 $('#freight').val(info.freight);
			 $('#paytype').val(info.paytype);
		  
		},'json'); 
	 
});
</script>